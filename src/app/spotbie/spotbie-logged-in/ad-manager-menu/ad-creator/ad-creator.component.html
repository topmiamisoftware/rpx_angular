<app-loading-screen *ngIf="loading"></app-loading-screen>

<div class="spotbie-overlay-window">

    <div #spbTopAnchor></div>

    <div class='sb-adCreatorWrapper'>
        
        <p class="cursor-pointer"
            *ngIf="(ad !== null && ad !== undefined) && ad.is_live !== 1"
            style="font-size: .8rem;"
            (click)="activateAdMembership()">
            <i class="fas fa-exclamation-triangle"></i>
            <span class='spotbie-text-gradient text-uppercase '>CLICK & ACTIVATE THIS AD NOW</span>
        </p>

        <h5 class="spotbie-text-gradient text-center text-uppercase pt-3 mb-4">AD EDITOR</h5>

        <form [formGroup]="adCreatorForm" *ngIf="adCreatorFormUp">

            <div class='spotbie-text-gradient text-uppercase text-center' #spbInputInfo></div>

            <div *ngIf="adFormSubmitted && f.adType.errors else adTypeTemplate" 
                  class="spotbie-input-info spotbie-text-gradient spotbie-error mt-4 mb-2">
            
                <div *ngIf="f.adType.errors.required">
                    You must pick an ad type!
                </div>
                
            </div> 
            
            <ng-template #adTypeTemplate>

                <label class="spotbie-input-info spotbie-text-gradient mb-2">
                    Pick Ad Type
                </label>     

            </ng-template>

            <mat-form-field class="sb-input" style="padding-left: 0px;" appearance="fill">

                <mat-label>Ad Format</mat-label>
                
                <mat-select formControlName="adType" [(value)]="selected" (selectionChange)="adTypeChange()">

                  <mat-option *ngFor="let adType of adTypeList; let i = index;" [value]="i">{{ adType.name }}</mat-option>

                </mat-select>
                
            </mat-form-field>

            <div *ngIf="adFormSubmitted && f.adName.errors else adNameNormalTemplate" 
                    class="spotbie-input-info spotbie-text-gradient spotbie-error mt-2 mb-2">
    
                <div *ngIf="f.adName.errors.required">
                    Enter ad name.
                </div>

                <div *ngIf="f.adName.errors.maxlength">
                    Maximum length - ad name - 50
                </div>

            </div> 
            
            <ng-template #adNameNormalTemplate>

                <label class="spotbie-input-info spotbie-text-gradient mt-2 mb-2">
                    Ad Name
                </label>     

            </ng-template>

            <input class="sb-input" 
                    (click)="$event.target.select()"
                    formControlName="adName" 
                    type="text"
                    placeholder="My Ad"
                    maxlength="50" /> 

            <div *ngIf="adFormSubmitted && f.adDescription.errors else adDescriptionNormalTemplate" 
                    class="spotbie-input-info spotbie-text-gradient spotbie-error mt-4 mb-2">

                <div *ngIf="f.adDescription.errors.required">
                    Enter ad description.
                </div>

                <div *ngIf="f.adDescription.errors.minlength">
                    Min. length - description - 50
                </div>

                <div *ngIf="f.adDescription.errors.maxlength">
                    Max length - description - 250
                </div>
                
            </div> 
            
            <ng-template #adDescriptionNormalTemplate>

                <label class="spotbie-input-info spotbie-text-gradient mt-4 mb-2">
                    Briefly describe your ad.
                </label>     

            </ng-template>

            <textarea class='spotbie-textarea spotbie-text-gradient mb-2' 
                        (click)="$event.target.select()" 
                        formControlName="adDescription" 
                        maxlength="150"
                        placeholder="Ad Description"
                        style="margin: 0 auto;"></textarea>

            <span class='spotbie-text-gradient'>{{ adDescription.length }}/150</span>

            <input type="hidden" formControlName="adImage" />

        </form>

        <form>                    

            <div *ngIf="adFormSubmitted && f.adImage.errors else adMediaUploadInfoTemplate" 
                    class="spotbie-input-info text-uppercase spotbie-text-gradient text-center spotbie-error mt-4 mb-2">

                <div *ngIf="f.adImage.errors.required">
                    Upload Ad Image
                </div>
                
            </div> 
            
            <ng-template #adMediaUploadInfoTemplate>

                <div class="spotbie-input-info text-uppercase spotbie-text-gradient text-center mt-4 mb-2 cursor-pointer" 
                    (click)="startAdMediaUploader()" #adMediaUploadInfo>
                    {{ adMediaMessage }} ({{ adTypeList[selected].dimensions }})
                </div>     

            </ng-template>

            <input type="file" 
                    class='spotbie-background-upload-input' 
                    #adMediaInput 
                    (change)="uploadMedia(adMediaInput.files)" 
                    accept="image/jpeg, image/gif, image/png"
                    multiple=false />

            <div (click)="startAdMediaUploader()" class='cursor-pointer'>

                <app-header-ad-banner #adApp class="pe-none" *ngIf="adType == 0" [ad]="ad" [business]="business" [editMode]="true"></app-header-ad-banner>
                <app-nearby-featured-ad #adApp class="pe-none" *ngIf="adType == 1" [ad]="ad" [business]="business" [editMode]="true"></app-nearby-featured-ad>
                <app-bottom-ad-banner #adApp class="pe-none" *ngIf="adType == 2" [ad]="ad" [business]="business" [editMode]="true"></app-bottom-ad-banner>
            
            </div> 

            <h6 class='sb-text-light-green-gradient mt-2'>SPOTBIE AD PREVIEW</h6>

        </form>

        <div class='spotbie-button text-uppercase mt-5' (click)="saveAd()">
            <span class='spotbie-text-gradient'>SAVE</span>
            <i class='fa fa-check'></i>
        </div>

        <div class='mt-5 mb-5 sb-deleteMe' *ngIf="ad !== null && ad !== undefined" (click)="deleteMe()">
            <span class="spotbie-text-gradient">DELETE AD SUBSCRIPTION </span><i class='fa fa-trash'></i>
        </div>

        <div class='mt-5 mb-5 cursor-pointer' (click)="closeThis()">
            <span class="spotbie-text-gradient">CANCEL</span>
        </div>

    </div>

</div>

<div class='spotbie-overlay-window' *ngIf="adCreated">

    <div class='sb-v-wrapper' style="display: grid; align-content: center;">
        
        <h4 class="spotbie-text-gradient spotbie-r-success-title text-uppercase">UPLOAD SUCCESSFUL</h4>

        <div class="sb-verificationCheck sb-text-light-green-gradient mt-4 mb-4">
            <i class="fa fa-check"></i>
        </div>

        <h4 class="spotbie-text-gradient spotbie-r-success-title text-uppercase">PAYMENT PENDING</h4>

    </div>

</div>

<div class='spotbie-overlay-window' *ngIf="adDeleted">

    <div class='sb-v-wrapper' style="display: grid; align-content: center;">
        
        <h4 class="spotbie-text-gradient text-uppercase">AD WAS DELETED</h4>

        <div class="sb-verificationCheck sb-text-light-green-gradient mt-4 mb-4">
            <i class="fa fa-check"></i>
        </div>

        <h4 class="spotbie-text-gradient text-uppercase">CONTINUE</h4>

    </div>

</div>
