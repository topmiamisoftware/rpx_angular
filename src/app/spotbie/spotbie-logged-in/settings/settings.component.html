<app-loading-screen *ngIf="loading"></app-loading-screen>

<div class='spotbie-overlay-window' #spotbieSettingsWindow>    
    
    <div class='spotbie-block'>

        <div #spotbieSettingsInfoText class="spotbie-text-gradient text-uppercase mt-2 mb-4"></div>

        <form [formGroup]="settingsForm" *ngIf="settingsFormInitiated">

            <table class='spotbie-settings-table'>
                
                <div *ngIf="submitted && f.spotbie_username.errors else username_normal" class="spotbie-input-info  spotbie-text-gradient spotbie-error">
            
                    <div *ngIf="f.spotbie_username.errors.required">
                        You must enter a username!
                    </div>

                    <div *ngIf="f.spotbie_username.errors.maxlength || f.spotbie_username.errors.wrongLength">
                        Your username cannot be longer than 15 characters.
                    </div> 
                    
                    <div *ngIf="f.spotbie_username.errors.illegalChars">
                        Must only contain letters, numbers, dots, and underscores.
                    </div> 
                    
                </div> 
                
                <ng-template #username_normal>
                    <div #spotbie_settings_issues class="spotbie-input-info spotbie-text-gradient text-uppercase">
                        Change your username
                    </div>          
                </ng-template>

                <tr>
                    <td>
                        <input class="sb-input" (click)="$event.target.select()" formControlName="spotbie_username" type="text" value="username" maxlength="35" />
                    </td>
                </tr>

                <div *ngIf="submitted && f.spotbie_first_name.errors else user_first_name_normal" class="spotbie-input-info text-uppercase spotbie-text-gradient spotbie-error">
            
                    <div *ngIf="f.spotbie_first_name.errors.required">
                        Please identify yourself!
                    </div>
                    
                    <div *ngIf="f.spotbie_first_name.errors.maxlength">
                        Your name cannot be longer than 72 characters.
                    </div>  

                </div> 
                
                <ng-template #user_first_name_normal>
                    <label class="spotbie-input-info spotbie-text-gradient text-uppercase">
                        What is your first name?
                    </label>
                </ng-template>

                <tr>
                    <td>
                        <input class="sb-input" (click)="$event.target.select()" formControlName="spotbie_first_name" type="text" value="name" maxlength="72" />
                    </td>
                </tr> 
                
                <div *ngIf="submitted && f.spotbie_last_name.errors else user_last_name_normal" class="spotbie-input-info  animated shake">
            
                    <div *ngIf="f.spotbie_last_name.errors.required">
                        Please identify yourself!
                    </div>
                    
                    <div *ngIf="f.spotbie_last_name.errors.maxlength">
                        Your name cannot be longer than 72 characters.
                    </div>  

                </div> 
                
                <ng-template #user_last_name_normal>
                    <label class="spotbie-input-info spotbie-text-gradient text-uppercase">
                        What is your last name?
                    </label>
                </ng-template>

                <tr>
                    <td>
                        <input class="sb-input" (click)="$event.target.select()" formControlName="spotbie_last_name" type="text" value="name" maxlength="72" />
                    </td>
                </tr> 

                <div *ngIf="submitted && f.spotbie_email.errors else user_email_normal" class="spotbie-input-info  animated shake">
            
                    <div *ngIf="f.spotbie_email.errors.required">
                        Please enter your e-mail, it will be used if you lose your password.
                    </div>
            
                </div> 
                
                <ng-template #user_email_normal>
                    <div class="spotbie-input-info spotbie-text-gradient text-uppercase">
                        what is your email?
                    </div>
                </ng-template>

                <tr>
                    <td>
                        <input class="sb-input" (click)="$event.target.select()" formControlName="spotbie_email" type="text" value="email" maxlength="135"/>
                    </td>
                </tr>       

                <div class="spotbie-input-info spotbie-text-gradient text-uppercase">
                    Phone number
                </div>

                <tr>
                    <td>                                  
                        <input class='sb-input' type='tel' mask="(000) 000-0000" 
                            autocomplete="tel" placeholder='(555) 555-5555' formControlName="spotbie_phone_number"/>
                    </td>
                </tr>

                <div *ngIf="submitted && f.spotbie_acc_type.errors else user_account_type_normal" class="spotbie-input-info  spotbie-text-gradient spotbie-error">
            
                    <div *ngIf="f.spotbie_acc_type.errors.required">
                        You must choose an account type!
                    </div>
            
                </div> 
                
                <ng-template #user_account_type_normal>
                    <div class="spotbie-input-info spotbie-text-gradient text-uppercase">
                        Choose an account type
                    </div>
                </ng-template>

                <tr>
                    <td>
                        <div #userAccountTypeNormalScroll></div>
                        <input (click)="changeAccType()" 
                                class="sb-input spotbie-clickable-field" 
                                formControlName="spotbie_acc_type" 
                                type="text"
                                readonly="readonly" />
                    </td>
                </tr>

                <!-- Privacy and Ghost Mode Block : disable if account is not personal -->
                <tr *ngIf="account_type_category !== 'PLACE TO EAT'">
                    <td>
                        <table class="spotbie-toggle">

                            <tr>
                                <input type="hidden" formControlName="spotbie_ghost_mode" />

                                <td class="spotbie-toggle-info-text spotbie-text-gradient text-uppercase" id="spotbieGhostText" (click)="toggleGhostMode()">
                                    Ghost Mode <span>{{ghost_mode_state}}</span>
                                </td>
                                
                                <td class="spotbie-toggle-light" (click)="toggleGhostMode()" [ngStyle]="getLight(this.spotbie_ghost_mode)"></td>
                        
                                <td class="spotbie-toggle-help-switch" (click)="toggleHelp(this.ghost_mode_help)">?</td>
                    
                            </tr>
                        
                        </table>
                    </td>
                </tr>

                <tr *ngIf="account_type_category !== 'PLACE TO EAT'">
                    <td>
                        <table class="spotbie-toggle">

                            <tr>
                                <input type="hidden" formControlName="spotbie_privacy" />

                                <td class="spotbie-toggle-info-text spotbie-text-gradient text-uppercase" id="spotbiePrivacyText" (click)="togglePrivacy()">
                                    Privacy <span>{{privacy_state}}</span>
                                </td>
                        
                                <td class="spotbie-toggle-light" id="spotbiePrivacyLight" (click)="togglePrivacy()" [ngStyle]="getLight(this.spotbie_privacy)"></td>
                        
                                <td class="spotbie-toggle-help-switch" (click)="toggleHelp(this.privacy_help)">?</td>
                            </tr>
                        
                        </table>   
                    </td>
                </tr>
                <!-- End of Privacy and Ghost Mode Block  -->   

                <tr *ngIf="help_text.length > 0">
                    <td>
                        <div class="spotbie-help-text spotbie-text-gradient">
                            {{ help_text }}
                        </div>                
                    </td>
                </tr>

                <tr>
                    <td class='sb-button spotbie-save-settings-button text-uppercase mb-5' (click)="saveSettings()">
                        Save Settings
                    </td> 
                </tr>

            </table>

        </form>

        <div class='spotbie-overlay-window' *ngIf="placeSettingsFormUp">

            <form [formGroup]="placeToEatSettingsForm">
            
                <table class='spotbie-settings-table' style="border-bottom: unset;">
    
                    <!-- Locale Accounts information-->
                    <div *ngIf="account_type_category == 'PLACE TO EAT'">
                        <div *ngIf="placeFormSubmitted && i.spotbieOrigin.errors else spotbie_origin_normal" 
                              class="spotbie-input-info spotbie-text-gradient text-center spotbie-error">
                
                            <div *ngIf="i.spotbieOrigin.errors.required">
                                You must choose a place of origin!
                            </div>
                    
                        </div> 
                    </div>
                    
                    <ng-template #spotbie_origin_normal>
                        <div class="spotbie-input-info mb-2 spotbie-text-gradient text-uppercase text-center" *ngIf="account_type_category == 'PLACE TO EAT'" >
                            Where is your {{ account_type_category }} located?
                        </div>
                    </ng-template>
    
                    <tr *ngIf="account_type_category == 'PLACE TO EAT'">
                        
                        <td>
    
                            <div class='spotbie-map'>                   
    
                                <agm-map [streetViewControl]="false"
                                        id="spotbieMapG"
                                        *ngIf="locationFound"
                                        #spotbie_map
                                        [latitude]="lat" 
                                        [longitude]="lng"
                                        [styles]="map_styles"
                                        [zoom]="18">
    
                                    <agm-marker [latitude]="lat" 
                                                [longitude]="lng"
                                                [markerDraggable]="true"                                     
                                                (dragEnd)="markerDragEnd($event)"
                                                *ngIf="locationFound"
                                                [agmFitBounds]="true">
    
                                        <agm-info-window #spotbie_user_marker_info_window [isOpen]="claimBusiness">
                                            <table class='spotbie-place-result'>
                                                <tr>
                                                    <td *ngIf="originTile !== null">
                                                        {{ originTitle }}
                                                    </td>                            
                                                </tr>
                                            </table>                                              
                                        </agm-info-window>      
    
                                    </agm-marker>
    
                                </agm-map>
                                
                                <div class="map-prompt-mobile" (click)="mobileStartLocation()" *ngIf="!locationFound">
                                    
                                    <div class="title sb-button sb-getStarted text-uppercase">
                                        <span>GET STARTED</span>
                                    </div>
                                
                                </div>

                            </div>
                        
                        </td>

                    </tr>
                    
                    <div class="spotbie-input-info spotbie-text-gradient text-uppercase text-center" *ngIf="chosen_account_type == 1 && locationFound" >
                        Drag marker or use search bar
                    </div>
    
                    <tr *ngIf="account_type_category == 'PLACE TO EAT' && locationFound">
                        <td>
                            
                            <input class="sb-input spotbie-search-map-input sb-origin-address-input"
                                    (click)="$event.target.select()"
                                    (keydown)="searchMapsKeyDown($event)"
                                    autocorrect="off" 
                                    autocapitalize="off" 
                                    spellcheck="off" 
                                    type="text"
                                    formControlName="originAddress" 
                                    maxlength="72"
                                    #addressSearch />
                                    
                            <div class='sb-button text-uppercase sb-search-icon' (click)="searchMaps()"><i class='fa fa-search'></i></div>
    
                            <input class="sb-input" type="hidden" formControlName="spotbieOrigin" />                
    
                            <div class='spotbie-place-picker'>
                                <div class='spotbie-place' *ngFor="let prediction of address_results"  (click)="focusPlace(prediction);">
                                    <span class='spotbie-text-gradient text-uppercase'>{{ prediction.description }}</span>
                                </div>
                            </div>
    
                        </td>
                    </tr>                                         
                    
                    <div class='spotbie-input-info spotbie-text-gradient text-uppercase text-center mt-2 mb-3' 
                         *ngIf='locationFound'>
                        {{ originTitle }}
                    </div>

                    <img class='sb-business-img' [ngStyle]="getBusinessImgStyle()" *ngIf='locationFound' src="{{originPhoto}}" />
                    
                    <!--

                    <h6 class="spotbie-text-gradient text-uppercase mt-5 mb-4" #placeToEatMediaUploadInfo>
                        {{ placeToEatMediaMessage }}
                    </h6>                        

                    <input type="file" 
                        class='spotbie-background-upload-input' 
                        #placeToEatMediaInput (change)="uploadMedia(placeToEatMediaInput.files)" 
                        accept="image/jpeg, image/gif, image/png"
                        multiple=false >
        
                    <div class='spotbie-upload-new-background-holder' 
                        [ngStyle]="{ 'background' : 'url(' + originPhoto + ')' }"
                        (click)="startPlaceToEatMediaUploader()"
                        #placeToEatUploader>
                        <div class='spotbie-click-or-drag-upload'>
                            <span class="spotbie-text-gradient text-uppercase">tap or drag to upload</span>
                        </div>
                    </div>--> 
                
                    <div *ngIf="placeFormSubmitted && i.originTitle.errors else originTitleNormal" 
                            class="spotbie-input-info text-uppercase spotbie-text-gradient text-center spotbie-error">
    
                        <div *ngIf="i.originTitle.errors.required">
                            Please enter your {{ account_type_category }} title.
                        </div>                                                
    
                    </div>   

                    <ng-template #originTitleNormal>
    
                        <div class="spotbie-input-info spotbie-text-gradient text-center text-uppercase" *ngIf="account_type_category == 'PLACE TO EAT' && locationFound">
                            {{ account_type_category }} title
                        </div>
    
                    </ng-template>
    
                    <tr *ngIf="account_type_category == 'PLACE TO EAT' && locationFound">
                        <td>                                  
                            <input class='sb-input text-uppercase' type='text' placeholder='TITLE' formControlName="originTitle"/>
                        </td>
                    </tr>
    
                    <div *ngIf="placeFormSubmitted && i.originDescription.errors else spotbie_origin_description_normal" 
                            class="spotbie-input-info mb-3 spotbie-text-gradient text-center spotbie-error text-uppercase">
                
                        <div *ngIf="i.originDescription.errors.required">
                            You must enter a description!
                        </div>
                
                        <div *ngIf="i.originDescription.errors.maxlength">
                            Your description can only be 350 characters long.
                        </div>

                        <div *ngIf="i.originDescription.errors.minlength">
                            Your description must be at least 100 characters.
                        </div>
                
                    </div> 

                    <ng-template #spotbie_origin_description_normal>
                        <div class="spotbie-input-info spotbie-text-gradient text-uppercase text-center mb-3" *ngIf="account_type_category == 'PLACE TO EAT' && locationFound">
                            {{ account_type_category }} description
                        </div>
                    </ng-template>
    
                    <tr *ngIf="account_type_category == 'PLACE TO EAT' && locationFound">
    
                        <td style="background-color: rgba(0,0,0,.23); padding-top: 0px; padding-bottom: 0px;">
    
                            <textarea class='spotbie-textarea spotbie-text-gradient' 
                                        (click)="$event.target.select()" 
                                        formControlName="originDescription" 
                                        maxlength="350"
                                        style="margin: 0 auto;"></textarea>
    
                        </td>
    
                    </tr> 

                    <tr>
                        <div class='sb-button text-uppercase' (click)="startBusinessVerification()" *ngIf="locationFound">
                            Verify
                        </div>
                    </tr> 

                    <tr>
                        <div class='spotbie-text-gradient text-center text-uppercase mt-4 mb-5' 
                        style="cursor: pointer;" (click)="cancelPlaceSettings()">CANCEL</div>
                    </tr>

                </table>
            
            </form>

        </div>

        <div class='spotbie-overlay-window' *ngIf="placeToEatVerified" (click)="closeWindow()">

            <div class='sb-passKeyWrapper' style="display: grid; align-content: center;">
                
                <h4 class="spotbie-text-gradient text-uppercase">YOUR VERIFICATION WAS SUCCESSFUL</h4>

                <div class="sb-verificationCheck mt-4 mb-4">
                    <i class="fa fa-check"></i>
                </div>
    
                <h4 class="spotbie-text-gradient text-uppercase">YOU ARE READY TO START</h4>

            </div>

        </div>

        <div class='spotbie-overlay-window' style="background-color: rgba(0,0,0,.95);" *ngIf="passKeyVerificationFormUp">

            <div class='sb-passKeyWrapper' style="display: grid; align-content: center;">            

                <form [formGroup]="passKeyVerificationForm">
            
                    <table class='spotie-settings-table'>
                    
                        <div *ngIf="passKeyVerificationSubmitted && j.passKey.errors else passkey_normal" 
                             class="spotbie-input-info text-center text-uppercase spotbie-text-gradient spotbie-error mb-4">
    
                            <div *ngIf="j.passKey.errors.required">
                                Please enter your passkey.
                            </div>                                                
        
                            <div *ngIf="j.passKey.errors.invalid">
                                Passkey doesn't match.
                            </div> 

                            <div *ngIf="j.passKey.errors.minlength">
                                Passkey wrong length.
                            </div> 

                            <div *ngIf="j.passKey.errors.claimed">
                                Business already claimed.
                            </div>

                        </div>        
        
                        <ng-template #passkey_normal>
        
                            <div class="spotbie-input-info spotbie-text-gradient text-center text-uppercase mb-4">
                                Please enter your passkey.
                            </div>
        
                        </ng-template>
        
                        <tr>
                            <td>                                  
                                <input class='sb-input text-center' 
                                       type='text' 
                                       [patterns]="customPatterns" 
                                       mask="A00-A00"
                                       placeholder='A12-B34' 
                                       maxlength="7"
                                       formControlName="passKey" />
                            </td>
                        </tr>
                        
                        <tr>
                            <td> 
                                <div class='spotbie-text-gradient text-center text-uppercase mt-4'>
                                    Don't have one? Book 
                                    <span class='sb-freeDemo' (click)="calendly()">free demo with SpotBie here.</span>
                                </div>
                            </td>
                        </tr>

                        <tr>
                            <td>

                                <div class='sb-button text-uppercase mt-4' (click)="claimThisBusiness()" *ngIf="locationFound">
                                    FINISH
                                </div>

                                <div class='spotbie-text-gradient text-center text-uppercase mt-4' 
                                     style="cursor: pointer;" (click)="closePassKey()">CANCEL</div>

                            </td>
                        </tr>

                    </table>
    
                </form>

            </div>

        </div>

        <div class='spotbie-overlay-window' style="background-color: rgba(0,0,0,.95);" *ngIf="calendlyUp">

            <div class='sb-passKeyWrapper' style="display: grid; align-content: center;">  
                 
                <!-- Calendly inline widget begin -->
                <div id="calendlyEl" class="calendly-inline-widget"></div>                
                <!-- Calendly inline widget end -->

                <div class='spotbie-text-gradient text-center text-uppercase mt-4' 
                style="cursor: pointer;" (click)="calendly()">CLOSE</div>

            </div>

        </div>

    </div>
    
    <div class='spotbie-block mb-0' *ngIf="settingsFormInitiated">

        <form [formGroup]="password_form">

            <table class='spotbie-settings-table' id="spotbie-password-table">

                    <!-- Change Password Block -->
            
                    <div *ngIf="password_submitted && g.spotbie_password.errors else spotbie_password_normal" class="spotbie-input-info  spotbie-text-gradient spotbie-error">    
                
                        <div *ngIf="g.spotbie_password.errors.required">
                            Please provide a password.
                        </div>

                        <div *ngIf="g.spotbie_password.errors.wrongLength">
                            Username must be 1 to 15 characters long.
                        </div>

                        <div *ngIf="g.spotbie_password.errors.oneNumber">
                            Password must contain at least one number (0-9)!
                        </div> 

                        <div *ngIf="g.spotbie_password.errors.oneLowerCase">
                            Password must contain at least one lowercase letter (a-z)!
                        </div>  

                        <div *ngIf="g.spotbie_password.errors.oneUpperCase">
                            Password must contain at least one uppercase letter (A-Z)!
                        </div> 

                    </div> 
                    
                    <ng-template #spotbie_password_normal>
                        <div class="spotbie-input-info spotbie-text-gradient text-uppercase" #spotbie_password_change_info_text>
                            Change your password
                        </div>
                    </ng-template>            
        
                    <tr>
                        <td>
                            <input class="sb-input" (click)="$event.target.select()" formControlName="spotbie_password" type="password" value="password" autocomplete="false"/>
                        </td>
                    </tr>
            
                    <div *ngIf="password_submitted && g.spotbie_confirm_password.errors else spotbie_confirm_password_normal" class="spotbie-input-info  spotbie-text-gradient spotbie-error">
            
                        <div *ngIf="g.spotbie_confirm_password.errors.required">
                            Please confirm your password
                        </div>            
                        
                    </div> 
        
                    <ng-template #spotbie_confirm_password_normal>
                        <div class="spotbie-input-info spotbie-text-gradient text-uppercase">
                            Confirm your new password
                        </div>
                    </ng-template>  
        
                    <tr>
                        <td>
                            <input class="sb-input" (click)="$event.target.select()" formControlName="spotbie_confirm_password" type="password" value="newpassword" autocomplete="false" />
                        </td>
                    </tr>
            
                    <tr>
                        <td class='sb-button text-uppercase mb-5' (click)="savePassword()">
                            Save New Password
                        </td>
                    </tr>
                    <!-- End Of Change Password Block -->        
            </table>
        
            <div class="spotbie-overlay-window" *ngIf="save_password">
                
                <div class="sb-closeButton" (click)="cancelPasswordSet()">
                    <i class="fa fa-times"></i>
                </div>

                <div class="spotbie-toast-input-box">
                    
                    <table class='spotbie-settings-table'>

                        <div *ngIf="password_submitted && g.spotbie_current_password.errors else spotbie_current_password_normal" class="spotbie-input-info  spotbie-text-gradient spotbie-error">
        
                            <div *ngIf="g.spotbie_current_password.errors.required">
                                Please enter your current password.
                            </div>            
                    
                        </div> 
            
                        <ng-template #spotbie_current_password_normal>
                            <div class="spotbie-input-info spotbie-text-gradient text-uppercase" #current_password_info>
                                To complete the change, enter your CURRENT password.
                            </div>
                        </ng-template>

                        <tr>
                            <td>

                                <input class="sb-input" (click)="$event.target.select()" type="password" formControlName="spotbie_current_password" value="123456789" autocomplete="false">        
                            
                                <div class="sb-button sb-button-mini" (click)="completeSavePassword()">
                                    Complete Change
                                </div>
                                
                            </td>
                        </tr>

                    </table>  
        
                </div>
        
            </div>
        
        </form>
    
    </div>

    <div class='spotbie-block'>
        
        <table class="spotbie-settings-table" id="spotbie-deactivate-table" *ngIf="settingsFormInitiated">
            <tr>
                <td class='spotbie-text-gradient text-uppercase mb-5' style="margin-top: 0px; cursor: pointer;" (click)="startDeactivateAccount()">
                    Deactivate Account
                </td>
            </tr>
        </table>    
        
        <form [formGroup]="deactivation_form" *ngIf="account_deactivation">
    
            <div class="spotbie-toast-input-overlay">
        
                <div class="spotbie-toast-input-box">
                    
                    <div *ngIf="deactivation_submitted && h.spotbie_deactivation_password.errors else spotbie_deactivate_normal" class="spotbie-input-info  spotbie-text-gradient spotbie-error">
        
                        <div *ngIf="h.spotbie_deactivation_password.errors.required">
                            Please enter your current password.
                        </div>            
                
                    </div> 
        
                    <ng-template #spotbie_deactivate_normal>
                        <div class="spotbie-toast-info spotbie-text-gradient spotbie-deactivation-info" #spotbie_deactivation_info>
                            If you choose to deactivate your account, your information will remain in our system but it will be locked and no one will be able to access it. In this way, you will be able to restore 
                            all your data if you ever feel like coming back. Enter your password to deactivate your account.
                        </div>
                    </ng-template>  
        
                    <input class="sb-input" (click)="$event.target.select()" type="password" formControlName="spotbie_deactivation_password" autocomplete="false">
        
                    <div class="sb-button sb-button-mini text-uppercase" (click)="deactivateAccount()">
                        Deactivate
                    </div>
                    
                    <div class="spotbie-text-gradient text-center text-uppercase mt-4" (click)="cancelDeactivateAccount()">
                        CANCEL
                    </div>

                </div>
        
            </div>
    
        </form>
    </div>

    <div class="sb-closeButton" (click)="closeWindow()">
        <i class="fa fa-times"></i>
    </div>

    <div class='sb-vertical-align-wrapper' *ngIf="loadAccountTypes">
        <div class="spotbie-select-menu" style="display: table-cell; vertical-align: middle;">            
            <div>

                <div class="spotbie-input-info spotbie-text-gradient text-uppercase text-center mb-4">
                    choose your account type
                </div>

                <div class="spotbie-select-menu-option" *ngFor="let account_type of accountTypeList" (click)="selectAccountType(account_type)">
                    
                    <table class="spotbie-select-table">
                        <tr>
                            <td class='spotbie-select-table-text spotbie-text-link text-center text-uppercase'>{{ account_type }}</td>
                        </tr>
                    </table>  

                </div>
                
            </div>
        </div>  
    </div>
  
    <app-ads-main *ngIf="adSettingsWindow.open"></app-ads-main>

</div>
