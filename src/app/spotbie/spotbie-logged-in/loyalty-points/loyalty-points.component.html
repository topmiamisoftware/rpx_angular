<app-loading-screen *ngIf="loading"></app-loading-screen>

<div [ngClass]="getWindowClass()">

    <div>

        <h5 id="sp-lpTitle" class="spotbie-text-gradient text-center text-uppercase mt-4 mb-5">SPOTBIE LOYALTY POINTS</h5>

        <div class="spotbie-lpResetInfo spotbie-text-gradient" 
              *ngIf="userType !== eAllowedAccountTypes.Personal && loyaltyPointBalance.end_of_month !== null">

            Points reset on: {{ loyaltyPointBalance.end_of_month | date:'mediumDate' }}
        
    </div>

        <p class="mt-4 mb-4" (click)="initBusinessLoyaltyPoints()">   
            
            <span [ngClass]="loyaltyPointsClass()" *ngIf="loyaltyPointBalance.balance !== null">
                {{ loyaltyPointBalance.balance | number:'1.0':'en-US' }}
            </span>

            <span [ngClass]="loyaltyPointsClass()" *ngIf="loyaltyPointBalance.balance === null">
                0
            </span>

            <span class="sb-added-loyalty-points sb-text-light-green-gradient animated fadeOutUp" 
                    *ngIf="newUserLoyaltyPoints !== null"
                    #newBalanceLoyaltyPoints>+{{ newUserLoyaltyPoints | number:'1.0':'en-US' }}</span>

        </p>    

        <div class='spotbie-text-gradient' 
                style="cursor: pointer; display: inline-block;"
                *ngIf="userType !== eAllowedAccountTypes.Personal"
                (click)="resetMyBalance()">RESET BALANCE <i class='fa fa-refresh'></i></div>

        <div class='sb-text-light-green-gradient mt-2 mb-4' 
                *ngIf="userType !== eAllowedAccountTypes.Personal">
                {{ loyaltyPointBalance.reset_balance | number:'1.0':'en-US' }}
        </div> 

        <div class='spotbie-text-gradient text-uppercase cursor-pointer' (click)="closeThis()" *ngIf="fullScreenWindow">
            CLOSE
        </div>

    </div>
    
</div>

<div class="spotbie-overlay-window pt-5 d-flex align-items-center justify-content-center" *ngIf="businessLoyaltyPointsOpen">

    <div style="overflow-y: scroll; min-width: 100%;">

        <div #businessLoyaltyPointsInfo class="spotbie-loyaltyPointsInfo spotbie-text-gradient text-center text-uppercase">
            <h4 class="spotbie-text-gradient text-center text-uppercase">MONTHLY BUDGET</h4>
        </div>

        <form [formGroup]="businessLoyaltyPointsForm" *ngIf="businessLoyaltyPointsFormUp">

            <div *ngIf="businessLoyaltyPointsSubmitted && f.businessCoinPercentage.errors else percentage_normal" 
                    class="spotbie-input-info spotbie-text-gradient spotbie-error mt-4 mb-2">
        
                <div *ngIf="f.businessCoinPercentage.errors.required">
                    Point-to-Dollar Ratio %
                </div>
                
            </div> 
            
            <ng-template #percentage_normal>
                <label class="spotbie-input-info spotbie-text-gradient mb-2">
                    Point-to-Dollar Ratio %
                </label>          
            </ng-template>

            <input class="sb-input" 
                    (click)="$event.target.select()" 
                    (keyup)="calculateDollarValue()"
                    [dropSpecialCharacters]="false"
                    formControlName="businessCoinPercentage" 
                    type="text" 
                    placeholder="1.5%"
                    separatorLimit="1000"
                    suffix="%"
                    maxlength="6"
                    mask="percent" />     

            <div *ngIf="businessLoyaltyPointsSubmitted && f.businessLoyaltyPoints.errors else loyalty_points_normal" 
                    class="spotbie-input-info spotbie-text-gradient spotbie-error mt-4 mb-2">
        
                <div *ngIf="f.businessLoyaltyPoints.errors.required">
                    Loyalty Points per Month
                </div>
                
            </div> 
            
            <ng-template #loyalty_points_normal>
                <label class="spotbie-input-info spotbie-text-gradient mt-4 mb-2">
                    Loyalty Points per Month
                </label>          
            </ng-template>

            <input class="sb-input" 
                    (click)="$event.target.select()" 
                    (keyup)="calculateDollarValue()"
                    formControlName="businessLoyaltyPoints" 
                    type="text" 
                    placeholder="0" 
                    maxlength="7"
                    thousandSeparator="," 
                    mask="separator.0" />            
        
        </form>               
        
        <p class="spotbie-text-gradient text-uppercase mt-4" style="font-size: .8rem !important;" *ngIf="monthlyDollarValueCalculated">
            monthly dollar value ${{ userPointToDollarRatio | number:'1.0':'en-US' }}
        </p>

        <div class='spotbie-howDoesItWork spotbie-text-gradient text-center text-uppercase mt-4' (click)="toggleHelp()" style="cursor: pointer;">
            <i class='fa fa-question-circle'></i>how does it work?
        </div>

        <div class='sb-helpBlock mt-4' *ngIf="helpEnabled" style="text-align: center;">

            <p class='spotbie-text-gradient mb-3'>
                Input the dollar value of each of your loyalty points.
            </p>

            <p class='spotbie-text-gradient mb-3'>
                Input the amount of loyalty points you want to give away each month.
            </p>

            <p class='spotbie-text-gradient mb-3'>
                When your customers <b>scan your QR code</b>, they will get an amount of loyalty points directly proportional to their bill.
            </p>     

            <p class='spotbie-text-gradient mb-3'>
                Let's say your customer spent <b>$200</b> on their bill. If your <b>loyalty points are worth 2.5% of a dollar</b>, then your customer will gain
                <br/><b>$200.00 * (2.5%/100) = 5 Loyalty Points</b>!
            </p> 

        </div>

        <div class='spotbie-button text-uppercase mt-3' (click)="submitBusinessLoyaltyPoints()">
            SAVE
        </div>    

        <div class='spotbie-text-gradient text-center text-uppercase mt-4' 
                style="cursor: pointer;" (click)="closeBusinessLoyaltyPoints()">
            <span class='spotbie-text-gradient text-center text-uppercase'>CLOSE</span>
        </div>

    </div>

</div>
