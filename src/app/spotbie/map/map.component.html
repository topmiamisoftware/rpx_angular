<app-loading-screen *ngIf="loading" text="loadingText"></app-loading-screen>

<div class='spotbie-overlay-window'>  

  <div [ngClass]="getMapWrapperClass()">
    
    <div #scrollMapAppAnchor></div>

    <agm-map  [ngClass]="getMapClass()"
              [streetViewControl]="false"
              *ngIf="map"
              #spotbie_map
              [latitude]="lat" 
              [longitude]="lng"
              [styles]="map_styles"
              [zoom]="zoom"
              [fitBounds]="fitBounds">

        <agm-overlay [latitude]="lat" [longitude]="lng" *ngIf="locationFound">

          <div class='spotbie-marker-bg'
                *ngIf="iconUrl"
                [ngStyle]="{'background' : 'url(' + iconUrl + ')',                      
                            'border' : '2px solid ' + bg_color }">
          </div>

        </agm-overlay>

        <agm-marker [latitude]="lat" 
                    [longitude]="lng"
                    *ngIf="locationFound"
                    [opacity]="0"
                    (markerClick)="selfMarker()"
                    [agmFitBounds]="true">

          <agm-info-window #spotbie_user_marker_info_window [isOpen]="true">
            <div class='agm_infowindow_color'>{{ spotbie_username }}</div>
          </agm-info-window>

        </agm-marker>

        <div *ngIf="displaySurroundingObjectList">

        <agm-overlay *ngFor="let mapObject of surroundingObjectList"                  
                    [latitude]="mapObject.loc_x"
                    [longitude]="mapObject.loc_y">

          <div class='spotbie-marker-bg' 
              (click)="pullMarker(mapObject)"
              title="{{ mapObject.username }}"
              [ngStyle]="{ 'background' : 'url(' + mapObject.map_icon + ')' }">
          </div>

        </agm-overlay>  

        </div>

        <div *ngIf="show_search_box && searchResults.length > 0">

          <agm-overlay *ngFor="let mapObject of searchResults"
                        [latitude]="mapObject.coordinates.latitude" 
                        [longitude]="mapObject.coordinates.longitude">

          <div class='spotbie-marker-bg'
              (click)="pullSearchMarker(mapObject)"
              [ngStyle]="{ 'background' : 'url(' + mapObject.icon + ')' }">
          </div>

          </agm-overlay>                    

          <agm-marker *ngFor="let mapObject of searchResults"
                      [latitude]="mapObject.coordinates.latitude" 
                      [longitude]="mapObject.coordinates.longitude"
                      [agmFitBounds]="true"
                      [visible]="false"></agm-marker>

        </div>

    </agm-map>    

    <div class='spotbie-search-results' *ngIf="show_search_box && searchResults.length > 0">

      <div #scrollMapAppAnchor></div>
      
      <app-ad class='spotbie-ad' [category]=""></app-ad>

      <div class='spotbie-close-results' (click)="closeSearchResults()">close</div>
    
      <div class='spotbie-search-results-title text-uppercase' *ngIf="type_of_info_object == 'yelp_business'">

        Distance
        <mat-slider min="1" max="25" step="1" value="{{ maxDistance }}"
                    (change)="updateDistance($event)"></mat-slider>
        {{ maxDistance }} mi.                            

      </div>
    
      <div class='spotbie-search-results-title text-uppercase' *ngIf="type_of_info_object == 'ticketmaster_events'">

        Distance  
        <mat-slider min="1" max="50" step="1" value="{{ maxDistance }}"
                    (change)="updateDistance($event)"></mat-slider>
        {{ maxDistance }} mi.              

      </div>
    
      <div class='spotbie-search-results-title'>
    
        <table class='spotbie-controls-search-results' *ngIf="searchCategorySorter == 'food'">
          <tr>

            <td (click)="sortBy(0)" title="Sort By Distance">
              <img src='assets/images/map/distance.svg' />
            </td>

            <td (click)="sortBy(1)" title="Sort By Rating">
              <img src='assets/images/map/ratings.svg' />
            </td>
            
            <td (click)="sortBy(2)" title="Sort By Reviews">
              <img src='assets/images/map/reviews.svg' />
            </td>

            <td (click)="sortBy(3)" title="Sory By Pricing">
              <img src='assets/images/map/pricing.svg' />
            </td>
            
            <td (click)="sortBy(4)" title="Offers Delivery">
              <img class="sb-deliverySortImg"  src='assets/images/map/delivery.svg' />
            </td>
            
            <td (click)="sortBy(5)" title="Offers Pick-Up">
              <img class="sb-pickUpSortImg"  src='assets/images/map/pick-up.svg' />
            </td>
            
            <td (click)="sortBy(6)" title="Offers Reservations">
              <img class="sb-reservationsSortImg" src='assets/images/map/reservations.svg' />
            </td>

          </tr>    
        </table>
    
        <table class='spotbie-controls-search-results' 
                (click)="showOpen()" 
                title="Opened or Closed" 
                [ngStyle]="{ 'border-right' : 'unset' }" 
                *ngIf="searchCategorySorter == 'food'">
          
          <td *ngIf="!isMobile"> 
            <span class='fa fa-circle spotbie-is-open'></span>
          </td>

          <td *ngIf="showOpened == false && !isMobile">
            <span class='fa fa-circle spotbie-is-closed'></span>
          </td>

          <td *ngIf="showOpened == true">
            OPEN
          </td>

          <td *ngIf="showOpened == false">
            OPEN/CLOSED
          </td>

        </table>
      
        <table class='spotbie-controls-search-results' *ngIf="searchCategorySorter == 'shopping'">
          <tr>

            <td (click)="sortBy(0)" title="Sort By Distance">
              <img src='assets/images/map/distance.svg' />
            </td>

            <td (click)="sortBy(1)" title="Sort By Rating">
              <img src='assets/images/map/ratings.svg' />
            </td>

            <td (click)="sortBy(2)" title="Sort By Reviews">
              <img src='assets/images/map/reviews.svg' />
            </td>

            <td (click)="sortBy(3)" [ngStyle]="{ 'border-right' : 'unset' }"  title="Sory By Pricing">
              <img src='assets/images/map/pricing.svg' />
            </td> 

          </tr>  
        </table>
    
        <table (click)="showOpen()" title="Opened or Closed" [ngStyle]="{ 'border-right' : 'unset' }" *ngIf="searchCategorySorter == 'shopping'">
          <td><span class='fa fa-circle spotbie-is-open'></span></td>
          <td *ngIf="showOpened == false"><span class='fa fa-circle spotbie-is-closed'></span></td>
          <td *ngIf="showOpened == true">OPEN</td>
          <td *ngIf="showOpened == false">OPEN/CLOSED</td>
        </table>   
        
        <table class='spotbie-controls-search-results text-uppercase' *ngIf="searchCategorySorter == 'events'">
          <tr>
            <td (click)="hideSearchResults()" title="Hide Results"><img src='assets/images/map/hide.svg' /></td>
            <td (click)="sortBy(0)" title="Sort By Distance"><img src='assets/images/map/distance.svg' /></td>
            <td (click)="sortBy(3)" title="Sort By Pricing"><img src='assets/images/map/pricing.svg' /></td>
            <td (click)="sortBy(7)" title="Events Today">Today</td>
            <td (click)="sortBy(8)" title="Events This Weekend" [ngStyle]="{ 'border-right' : 'unset' }">This Weekend</td>
          </tr>    
        </table>
    
      </div>
    
      <div class='spotbie-search-results-title spotbie-sorting text-uppercase'>
    
        Sorted by {{ sort_by_txt }} 
        <span *ngIf="sortAc != 4 && sortAc != 5 && sortAc != 6 && sortAc != 7 && sortAc != 8">({{ sorting_order }})</span>
        <span (click)="showOpen()" *ngIf="searchCategorySorter != 'events'"> - {{ showingOpenedStatus }}</span>
    
        <ng-template *ngIf="searchCategorySorter != 'events'">
          <span class='fa fa-circle spotbie-is-open' [ngStyle]="{ 'margin-left' : '5px' }"></span>
          <span class='fa fa-circle spotbie-is-closed' *ngIf="showOpened == false" [ngStyle]="{ 'margin-left' : '5px' }"></span>
        </ng-template>
    
      </div>
    
      <div class='spotbie-search-result-wrapper' *ngIf="showSearchResults">
    
        <div class='spotbie-search-results-title text-uppercase'>
    
          <span *ngIf="searchCategory !== 'events'">Showing results within {{ maxDistance }} miles. </span>
          
          <div></div> 

          <span class='sb-page-button text-uppercase cursor-pointer' (click)="goToPage(1)" *ngIf="allPages > 1">
            <i class="fa fa-angle-double-left"></i>
          </span> 

          <span class='sb-page-button text-uppercase cursor-pointer' (click)="loadMoreResults(0)" *ngIf="allPages > 1">
            <i class="fa fa-angle-left"></i>
          </span>   
          
          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page - 2))" 
                [ngStyle]="displayPage((around_me_search_page - 2))">{{ around_me_search_page - 2 }}</span>

          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page - 1))" 
                [ngStyle]="displayPage((around_me_search_page - 1))">{{ around_me_search_page - 1 }}</span>

          <span class="spotbie-result-page active">{{ around_me_search_page }}</span>

          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page + 1))" 
                [ngStyle]="displayPageNext((around_me_search_page + 1))">{{ around_me_search_page + 1 }}</span>

          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page + 2))" 
                [ngStyle]="displayPageNext((around_me_search_page + 2))">{{ around_me_search_page + 2 }}</span>

          <span class='sb-page-button text-uppercase cursor-pointer' (click)="loadMoreResults(1)" *ngIf="allPages > 1">
            <i class="fa fa-angle-right"></i>
          </span>
      
          <span class='sb-page-button text-uppercase cursor-pointer' (click)="goToPage(allPages - 1)" *ngIf="allPages > 1">
            <i class="fa fa-angle-double-right"></i>
          </span>         

          <span class='spotbie-search-page-number'>{{ around_me_search_page }}/{{ allPages - 1 }}</span>
      
        </div>
        
        <div class='spotbie-no-results' *ngIf='searchResults.length == 0'>No Results Available.</div>
    
        <div class='spotbie-search-result' *ngFor='let search_result of searchResults' (click)="pullSearchMarker(search_result)">
          
          <table class='spotbie-search-result-table'>
            <tr>
              
              <td *ngIf="search_result.image_url != '0'">
                <div class='spotbie-search-result-image'[ngStyle]="{ 'background' : 'url(' + search_result.image_url + ')' }" ></div>          
              </td>
              
              <td *ngIf="type_of_info_object == 'yelp_business'">
    
                <div class='spotbie-search-result-title' >
            
                  {{ search_result.name }} 
                  
                  <span class='spotbie-search-result-price' *ngIf="search_result.price_on == '1'">({{ search_result.price }})</span>
          
                </div>
    
                <table class='spotbie-yelp-rating-table'>
                  <tr>
                    <td>
                      <div class='spotbie-search-result-rating-img' [ngStyle]="{ 'background' : 'url(' + search_result.rating_image + ')' }"></div>
                    </td>
                    <td>
                      <div class='spotbie-search-result-yelp-logo' [ngStyle]="{ 'background' : 'url(assets/images/yelp/yelp_logo.png)' }"></div>
                    </td>
                  </tr>
                </table>
      
                <div class='spotbie-review-count'>
                  Based on {{ search_result.review_count }} Reviews
                </div>
    
                <div class='spotbie-distance'>
                  {{ search_result.distance }} miles from you.
                </div>                        
    
                <div class='spotbie-search-result-phone' *ngIf="search_result.phone != ''">
                  {{ search_result.display_phone }}
                </div>       
    
              </td>
    
              <td *ngIf="type_of_info_object == 'ticketmaster_events'">
    
                <div class='spotbie-venue-name' *ngIf="search_result._embedded.venues[0]">
                  {{ search_result._embedded.venues[0].name }}
                </div>
    
                <div class='spotbie-distance'>
                  {{ search_result.distance }} miles from you.
                </div>
                            
                <div class='spotbie-time-event' *ngIf="search_result.dates.start.localDate">
                  {{ search_result.dates.start.spotbieDate }}
                </div>
    
                <div class='spotbie-time-event' *ngIf="search_result.dates.start.spotbieHour">
                  {{ search_result.dates.start.spotbieHour }}
                </div>
    
                <div class='spotbie-price-ranges' *ngIf="search_result.priceRanges !== undefined">
                  Price Ranges ${{ search_result.priceRanges[0].min }} to ${{ search_result.priceRanges[0].max }}
                </div>
    
                <div class='spotbie-event-code' *ngIf="search_result.dates.status.code">
                  Status: {{ search_result.dates.status.code }}
                </div>      
    
              </td>
    
            </tr>
    
          </table>
      
          <div class='spotbie-search-result-transactions' *ngIf="search_result.transactions_on == '1'">{{ search_result.friendly_transactions }}</div>
    
        </div>
    
        <div>
    
          <div></div> 

          <span class='sb-page-button text-uppercase cursor-pointer' (click)="goToPage(1)" *ngIf="allPages > 1">
            <i class="fa fa-angle-double-left"></i>
          </span> 

          <span class='sb-page-button text-uppercase cursor-pointer' (click)="loadMoreResults(0)" *ngIf="allPages > 1">
            <i class="fa fa-angle-left"></i>
          </span>   
          
          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page - 2))" 
                [ngStyle]="displayPage((around_me_search_page - 2))">{{ around_me_search_page - 2 }}</span>

          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page - 1))" 
                [ngStyle]="displayPage((around_me_search_page - 1))">{{ around_me_search_page - 1 }}</span>

          <span class="spotbie-result-page active">{{ around_me_search_page }}</span>

          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page + 1))" 
                [ngStyle]="displayPageNext((around_me_search_page + 1))">{{ around_me_search_page + 1 }}</span>

          <span class="spotbie-result-page" 
                (click)="goToPage((around_me_search_page + 2))" 
                [ngStyle]="displayPageNext((around_me_search_page + 2))">{{ around_me_search_page + 2 }}</span>

          <span class='sb-page-button text-uppercase cursor-pointer' (click)="loadMoreResults(1)" *ngIf="allPages > 1">
            <i class="fa fa-angle-right"></i>
          </span>
      
          <span class='sb-page-button text-uppercase cursor-pointer' (click)="goToPage(allPages - 1)" *ngIf="allPages > 1">
            <i class="fa fa-angle-double-right"></i>
          </span>

          <div></div>

          <span class='spotbie-search-page-number'>{{ around_me_search_page }}/{{ allPages - 1 }}</span>
    
        </div>
    
      </div>

    </div>

    <div class='spotbie-search-results no-results' *ngIf="showNoResultsBox">
      
      <div class='spotbie-no-results' style="text-align: center;" *ngIf="sortEventDate == 'none'">No results available for "{{ search_keyword }}" within {{ maxDistance }} miles.</div>
      <div class='spotbie-no-results' style="text-align: center;" *ngIf="sortEventDate == 'today'">No results today available for "{{ search_keyword }}" within {{ maxDistance }} miles.</div>
      <div class='spotbie-no-results' style="text-align: center;" *ngIf="sortEventDate == 'weekend'">No results this weekend available for "{{ search_keyword }}" within {{ maxDistance }} miles.</div>
    
      <div class='spotbie-search-results-title text-uppercase'>
        Distance  <mat-slider min="0" max="{{ maxDistanceCap }}" step="1" value="{{ maxDistance }}"
                                (change)="updateDistance($event)"></mat-slider>
        {{ maxDistance }} mi.                            
      </div>
    
    </div>

    <div [ngClass]="getMapPromptMobileClass()" *ngIf="business" #featureWrapper>

      <div [ngClass]="getMapPromptMobileInnerWrapperClassOne()">

        <app-business-features (signUpEvent)="signUp()" *ngIf="isLoggedIn !== '1'"></app-business-features>

        <app-business-dashboard *ngIf="isLoggedIn == '1'" #homeDashboard (openBusinessSettingsEvt)="openBusinessSettings()"></app-business-dashboard>

      </div>

    </div>

    <div class="map-prompt-mobile pe-none" *ngIf="showMobilePrompt2">

      <div class="spotbie-text-gradient text-uppercase title" id="doubleTapThis"></div>

    </div>    

    <div class="sb-footer pt-5 pb-5" *ngIf="business">

      <p [routerLink]="['/terms']">Terms & Privacy Policy</p>
      <img class="mt-3 mb-3" src="assets/images/home_imgs/logo_spotbie-02.svg" />
      <p [routerLink]="['/terms']">SpotBie, LLC.&copy; Copyright 2021</p>
  
    </div>

    <div [ngClass]="getMapPromptMobileClass()" *ngIf="!business" #featureWrapper>

      <div [ngClass]="getMapPromptMobileInnerWrapperClassOne()">

        <app-user-features (spawnCategoriesEvt)="spawnCategories($event)" *ngIf="isLoggedIn !== '1'"></app-user-features>        
        
        <app-user-dashboard *ngIf="isLoggedIn == '1'" #homeDashboard></app-user-dashboard>

      </div>

    </div>

  </div>

  <div class='spotbie-category-search-yelp animated slideInUp' *ngIf="catsUp">
  
    <input type='text' 
            class='spotbie-searchbar sb-input' 
            placeholder="{{ searchCategoriesPlaceHolder }}" 
            (keyup)="searchSpotBie($event)" />
  
    <div class='spotbie-close-categories' 
          (click)="closeCategories()" 
          *ngIf="catsUp">
      close
    </div>
  
  </div>
  
  <div class='spotbie-categories animated slideInRight' *ngIf="catsUp && searchCategory != 'events'">
  
    <div *ngFor="let category of categories; let i = index" [ngClass]="getSingleCatClass(i)" (click)="apiSearch(category)">
      {{ category }}
    </div>
  
  </div>
  
  <div class='spotbie-categories animated slideInRight' *ngIf="catsUp && searchCategory == 'events'">
  
    <div [ngClass]="getSingleCatClass(i)" *ngFor="let category of categories; let i = index" (click)="showEventSub(category)">
      
      {{ category.name }}
  
      <!--<div class='spotbie-sub-cat-wrapper' *ngIf="category.show_sub && category.type !== undefined">
  
        <div class='spotbie-sub-cat' *ngFor="let sub_cat_type of category.type._embedded.subtypes" (click)="apiSearch(sub_cat_type.name)" [SpotBieStopClickPropagation]>
          
          {{ sub_cat_type.name }}
  
        </div>
  
      </div>-->
  
      <div class='spotbie-sub-cat-wrapper' *ngIf="category.show_sub && category.segment !== undefined">
  
        <div class='spotbie-sub-cat' *ngFor="let sub_cat_type of category.segment._embedded.genres" (click)="apiSearch(sub_cat_type.name, true)" [SpotBieStopClickPropagation]>
          
          {{ sub_cat_type.name }}
  
          <!--<div *ngIf="sub_cat_type.show_sub_sub">
  
            <div class='spotbie-subgenre' *ngFor="let subgenre of sub_cat_type._embedded.subgenres" (click)="apiSearch(subgenre.name)" [SpotBieStopClickPropagation]>
  
              {{ subgenre.name }}
    
            </div>
  
          </div> -->
  
        </div>
  
      </div>    
  
    </div>
  
  </div>
  
  <app-info-object [info_object]="infoObject" (closeWindow)="infoObjectWindow.open = false" *ngIf="infoObjectWindow.open"></app-info-object>

  <app-user-info-object [currentMarker]="currentMarker" *ngIf="sliderRight" (close)="sliderRight = false"></app-user-info-object>

  <app-scroll-to-top></app-scroll-to-top>

</div>